<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rocket Orbit (Air Start)</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui}
canvas{display:block;width:100vw;height:100vh}

.hud{
 position:fixed;left:12px;top:12px;
 background:rgba(0,0,0,.45);color:#fff;
 padding:12px;border-radius:14px;
 font-size:13px;line-height:1.4;
}
.hud b{font-weight:800}
.row{display:flex;gap:8px;align-items:center;margin-top:6px}
input[type=range]{flex:1}
.toggle{margin-top:6px;font-size:12px}
.btns{
 position:fixed;right:12px;bottom:12px;
 display:grid;grid-template-columns:repeat(3,64px);
 grid-template-rows:repeat(2,64px);gap:10px
}
.btn{
 background:rgba(0,0,0,.45);color:#fff;
 border-radius:16px;display:flex;
 align-items:center;justify-content:center;
 font-size:14px;user-select:none
}
.btn:active{transform:translateY(1px)}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div class="hud">
<b>ğŸš€ Rocket Orbit</b>

<div class="row">
ê°ë„
<input id="angle" type="range" min="-180" max="180" value="0">
<span id="aVal">0Â°</span>
</div>

<div class="row">
ì¶”ë ¥
<input id="thr" type="range" min="0" max="100" value="0">
<span id="tVal">0%</span>
</div>

<div class="toggle">
<label><input type="checkbox" id="gOn" checked> ê°ë„ ê°€ì´ë“œ</label><br>
<label><input type="checkbox" id="pOn" checked> ì˜ˆìƒ ê¶¤ì </label>
</div>

<div style="margin-top:8px">
ê³ ë„ <b id="alt">0</b> m<br>
ì†ë„ <b id="spd">0</b> m/s<br>
ì—°ë£Œ <b id="fuel">100</b>%<br>
ê°€ì´ë“œ ê°ë„ <b id="gAng">0</b>Â°<br>
ìƒíƒœ <b id="stat">-</b>
</div>
</div>

<div class="btns">
<div class="btn" id="reset">R</div>
<div class="btn" id="up">â–²</div>
<div class="btn" id="cut">0</div>
<div class="btn" id="left">â—€</div>
<div class="btn"> </div>
<div class="btn" id="right">â–¶</div>
</div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
let W,H,DPR=1;
function resize(){
 DPR=Math.min(2,devicePixelRatio||1);
 W=c.width=innerWidth*DPR;
 H=c.height=innerHeight*DPR;
}
addEventListener("resize",resize);resize();

const Re=6_371_000, mu=3.986e14;
const rocket={
 x:0,y:0,vx:0,vy:0,
 ang:0,thr:0,fuel:100,
 alive:true,hold:0
};
const cam={x:0,y:0};
const trail=[];

function reset(){
 const startAlt=30_000;           // â˜… ê³µì¤‘ ì‹œì‘ ê³ ë„
 rocket.x=Re+startAlt; rocket.y=0;
 rocket.vx=0; rocket.vy=0;
 rocket.ang=0; rocket.thr=0;
 rocket.fuel=100; rocket.alive=true; rocket.hold=0;
 trail.length=0;
}
reset();

const angle=document.getElementById("angle");
const thr=document.getElementById("thr");
angle.oninput=()=>rocket.ang=+angle.value;
thr.oninput=()=>rocket.thr=+thr.value;

["left","right","up"].forEach(id=>{
 document.getElementById(id).onpointerdown=()=>keys[id]=true;
 document.getElementById(id).onpointerup=()=>keys[id]=false;
});
document.getElementById("cut").onclick=()=>rocket.thr=thr.value=0;
document.getElementById("reset").onclick=reset;

const keys={left:false,right:false,up:false};

function guideAngle(alt){
 if(alt<2000) return 0;
 if(alt<10000) return (alt-2000)/8000*10;
 if(alt<30000) return 10+(alt-10000)/20000*25;
 if(alt<60000) return 35+(alt-30000)/30000*25;
 if(alt<120000) return 60+(alt-60000)/60000*30;
 return 90;
}

function predict(){
 const pts=[];
 let s={...rocket};
 for(let i=0;i<120;i++){
  const r=Math.hypot(s.x,s.y);
  if(r<=Re) break;
  const ux=s.x/r, uy=s.y/r;
  const tx=-uy, ty=ux;
  const a=s.ang*Math.PI/180;
  let ax=-mu*s.x/(r*r*r);
  let ay=-mu*s.y/(r*r*r);
  ax+=Math.cos(a)*ux*30+Math.sin(a)*tx*30;
  ay+=Math.cos(a)*uy*30+Math.sin(a)*ty*30;
  s.vx+=ax*0.15; s.vy+=ay*0.15;
  s.x+=s.vx*0.15; s.y+=s.vy*0.15;
  pts.push({x:s.x,y:s.y});
 }
 return pts;
}

function m2p(m){return m*0.00015*DPR}
function sx(x){return W/2+m2p(x-cam.x)}
function sy(y){return H/2-m2p(y-cam.y)}

function draw(){
 ctx.clearRect(0,0,W,H);
 cam.x+= (rocket.x-cam.x)*0.05;
 cam.y+= (rocket.y-cam.y)*0.05;

 // Earth
 ctx.fillStyle="rgba(40,70,120,.6)";
 ctx.beginPath();
 ctx.arc(sx(0),sy(0),m2p(Re),0,Math.PI*2);
 ctx.fill();

 // trail
 ctx.strokeStyle="rgba(255,255,255,.3)";
 ctx.beginPath();
 trail.forEach((p,i)=>{
  if(i==0)ctx.moveTo(sx(p.x),sy(p.y));
  else ctx.lineTo(sx(p.x),sy(p.y));
 });
 ctx.stroke();

 // prediction
 if(pOn.checked){
  const pts=predict();
  ctx.setLineDash([6,8]);
  ctx.strokeStyle="rgba(255,255,255,.5)";
  ctx.beginPath();
  pts.forEach((p,i)=>{
   if(i==0)ctx.moveTo(sx(p.x),sy(p.y));
   else ctx.lineTo(sx(p.x),sy(p.y));
  });
  ctx.stroke(); ctx.setLineDash([]);
 }

 // rocket
 ctx.fillStyle="#fff";
 ctx.beginPath();
 ctx.arc(sx(rocket.x),sy(rocket.y),5*DPR,0,Math.PI*2);
 ctx.fill();
}

function update(dt){
 if(!rocket.alive) return;
 if(keys.left) rocket.ang-=90*dt;
 if(keys.right) rocket.ang+=90*dt;
 if(keys.up && rocket.fuel>0) rocket.thr=Math.min(100,rocket.thr+80*dt);
 else rocket.thr=Math.max(0,rocket.thr-60*dt);

 const r=Math.hypot(rocket.x,rocket.y);
 const alt=r-Re;
 const ux=rocket.x/r, uy=rocket.y/r;
 const tx=-uy, ty=ux;
 const a=rocket.ang*Math.PI/180;

 let ax=-mu*rocket.x/(r*r*r);
 let ay=-mu*rocket.y/(r*r*r);

 const thrust=rocket.thr/100*30;
 ax+=thrust*(Math.cos(a)*ux+Math.sin(a)*tx);
 ay+=thrust*(Math.cos(a)*uy+Math.sin(a)*ty);

 rocket.vx+=ax*dt; rocket.vy+=ay*dt;
 rocket.x+=rocket.vx*dt; rocket.y+=rocket.vy*dt;

 trail.push({x:rocket.x,y:rocket.y});
 if(trail.length>200)trail.shift();

 if(r<=Re){rocket.alive=false;}
}

let last=performance.now();
function loop(t){
 const dt=Math.min(0.02,(t-last)/1000); last=t;
 update(dt); draw();

 // UI
 const alt=Math.max(0,Math.hypot(rocket.x,rocket.y)-Re);
 aVal.textContent=Math.round(rocket.ang)+"Â°";
 tVal.textContent=Math.round(rocket.thr)+"%";
 altEl.textContent=Math.round(alt);
 spd.textContent=Math.round(Math.hypot(rocket.vx,rocket.vy));
 fuel.textContent=Math.round(rocket.fuel);
 gAng.textContent=Math.round(guideAngle(alt));

 requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
